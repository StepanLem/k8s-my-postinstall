# версию и values смотри на артифкатхаб:
# https://artifacthub.io/packages/helm/grafana/loki


# Тут указана конфигурация для dev.
# Пока что не требовалось настраивать для прода. Мб там elk всегда просто?

# Бля тут такая тупость. Какие-то говно дефолтные значения.


# Для dev окружения используем SingleBinary - проще и не требует object storage.
deploymentMode: SingleBinary

# Gateway для доступа к Loki (включен по умолчанию, нужен для Grafana)
# gateway:
#   enabled: true

# SingleBinary конфигурация
singleBinary:
  replicas: 1
  persistence:
    enabled: true
    size: 10Gi
    storageClass: "local-path-retain"  # используй local-path-provisioner если есть. Пусто - используется дефолтный

# Component replicas(0 when using SingleBinary)
write:
  replicas: 0
read:
  replicas: 0
backend:
  replicas: 0


# Основная конфигурация Loki
loki:
  # Отключаем auth для dev (для простоты)
  auth_enabled: false # это чё значит? А если включить?
  
  commonConfig:
    path_prefix: /var/loki
    replication_factor: 1
  
  # по нормальному надо schemaConfig настраивать. Бля крч походу надо будет глубже в эту хйню копать.
  useTestSchema: true
  # schemaConfig:
  #   configs:
  #     - from: 2024-01-01
  #       store: tsdb
  #       object_store: filesystem
  #       schema: v13
  #       index:
  #         prefix: index_
  #         period: 24h
  
  # Storage конфигурация для filesystem (для SingleBinary)
  storage:
    type: filesystem 
    filesystem:
      chunks_directory: /var/loki/chunks
      rules_directory: /var/loki/rules
  

# Caching. Без понятия зачем это
chunksCache:
  enabled: false
resultsCache:
  enabled: false

# Helm test
test:
  enabled: false

  


# Service для доступа к Loki (будет доступен как loki.monitoring.svc.cluster.local)
# По умолчанию создается автоматически

# Для подключения Loki к Grafana добавь в prometheus-stack values-of-prometheus-stack.yaml:
# grafana:
#   additionalDataSources:
#     - name: Loki
#       type: loki
#       access: proxy
#       url: http://loki-dev-gateway.monitoring.svc.cluster.local:80
#       isDefault: false
#       jsonData:
#         maxLines: 1000
# 
# Или проверь имя сервиса: kubectl get svc -n monitoring | grep loki

